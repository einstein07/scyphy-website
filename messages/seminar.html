<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seminar Details</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="seminar-detail">Loading…</div>
  <a href="index.html">← Back to all seminars</a>

  <script>
    async function loadSeminar() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
  
      const res = await fetch("../seminars.json");
      const seminars = await res.json();
      const seminar = seminars.find(s => s.id === id);
  
      const container = document.getElementById("seminar-detail");
      if (!seminar) {
        container.textContent = "Seminar not found.";
        return;
      }
  
      const isMissing = (v) => {
        if (v == null) return true;
        const s = String(v).trim();
        if (!s) return true;
        const up = s.toUpperCase();
        return up === "TBD" || up === "TBA";
      };
  
      const missing = [];
      if (isMissing(seminar.title))    missing.push("Title");
      if (isMissing(seminar.image))    missing.push("Speaker photo");
      if (isMissing(seminar.abstract)) missing.push("Abstract");
      if (isMissing(seminar.bio))      missing.push("Bio");
  
      const dynamicLink = `https://www.giovannireina.com/scyphy/seminar.html?id=${encodeURIComponent(seminar.id)}`;
  
      // --------- Build the two email texts (plain text, nice line breaks) ----------
      const emailAnnouncementText =
        `
        <p>Hello all,</p> 
        
        We are excited to continue our Short Cyber-Physical Seminars with an upcoming talk by ${seminar.speaker} on ${seminar.date} at ${seminar.time} in ${seminar.location}.
        The talk is titled: "${seminar.title}". <br>
        
        The abstract for the talk and the speaker’s bio can be found at:
        ${dynamicLink}
  
        <p>
        We look forward to seeing you at the seminar!<br>
        
        Full schedule and abstracts: https://www.giovannireina.com/scyphy/<br>
        </p>
        Best regards,<br>
        The ScyPhy Seminar Team`;
        
      const missingListHTML = missing.length
      ? `<p>We’re still missing the following for the website:</p>
         <ul>${missing.map(item => `<li>${item}</li>`).join("")}</ul>
         <p>Could you please send these at your convenience?</p>`
      : `<p>We have all the required materials for the website. Thank you!</p>`;
        
      const emailReminderHTML = `
      <p>Hello ${seminar.speaker},</p>
      <p>This is a friendly reminder about your upcoming seminar scheduled for <strong>${seminar.date}</strong> at <strong>${seminar.time}</strong>.</p>
      ${missingListHTML}
      <p>Best regards,<br>The ScyPhy Seminar Team</p>
    `;

    // Render HTML blocks
    container.innerHTML = `
      <h2>${seminar.title} by ${seminar.speaker}</h2>

      <section class="block">
        <div class="block-head">
          <h4>Email and Message</h4>
          <button class="copy-btn" data-copy-target="announce">Copy</button>
        </div>
        <div class="copy-src" id="copy-announce">${emailAnnouncementText}</div>
      </section>

      <section class="block">
        <div class="block-head">
          <h4>Reminder</h4>
          <button class="copy-btn" data-copy-target="reminder">Copy</button>
        </div>
        <div class="copy-src" id="copy-reminder">${emailReminderHTML}</div>
      </section>
    `;

    // Copy button logic
    document.querySelectorAll(".copy-btn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const target = btn.getAttribute("data-copy-target");
        const el = document.getElementById(`copy-${target}`);
        const text = el.innerText; // copies visible text (not HTML tags)
        try {
          await navigator.clipboard.writeText(text);
          flash(btn, "Copied!");
        } catch {
          const ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed"; ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          flash(btn, "Copied!");
        }
      });
    });

    function flash(button, msg) {
      const old = button.textContent;
      button.textContent = msg;
      button.disabled = true;
      setTimeout(() => { button.textContent = old; button.disabled = false; }, 1200);
    }
  }

  loadSeminar();
</script>
  
</body>
</html>
